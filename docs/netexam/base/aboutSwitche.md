---
title: 关于交换机
---

# {{ $frontmatter.title }}

## 前言
随着企业互联网的发展，越来越多的用户需要接入到网络，交换机提供的大量的接入端口能够很好的满足这种需求。同时，交换机也彻底解决了困扰早期以太网的冲突问题，极大地提升了以太网的性能，同时也提高了以太网的安全性。<br>
交换机工作在数据链路层，对数据帧进行操作，在收到数据帧后，交换机会根据数据帧的头部信息对数据帧进行转发。<br>

## 网络分层设计
通过使用分层网络设计原则和条理化设计方法，设计人员可以创建易于管理和易于支持的网络。
+ 易于理解、学习、排错。

::: details 企业网络基本架构
![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/image.png)
:::
最基本的网络架构
![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/switchjiagou.png)
其中接入层、汇聚层、核心层、出口层的一些功能为
| 接入层 | 用户接入 接入安全 访问控制      |
|-----|---------------------|
| 核心层 | 高速转发 服务器接入 路由选择     |
| 汇聚层 | 流量汇聚 链路冗余 设备冗余 路由选择 |
| 出口层 | 广域网接入 出口策略 带宽控制     |
|     |                     |


## 交换机的主要功能
如图
![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/switchMainfun.png)
+ 终端设备的接入
+ 以太网数据帧的交换，根据目的MAC地址转发数据帧
+ 学习MAC地址，并维护MAC地址表
+ 防止二层环路


![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/littleSwitchNet.png)
交换机根据MAC地址来转发数据帧。

**交换机的工作原理：** 根据MAC地址表中的MAC地址表项，做出智能转发<br>
![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/work.png)

**具体内容：**
| **原理**    | **描述**                                                                                        |
|-----------|-----------------------------------------------------------------------------------------------|
| 学习 Learn  | 从一个接口收到数据帧时，把数据帧的源MAC地址和该接口进行绑定，存放MAC地址表                                                      |
| 泛洪Flood   | 从一个接口收到广播帧、组播帧、未知单播帧，把该帧从其他所有接口转发出去（除接收口）                                                     |
| 转发Forward | 从一个接口收到已知单播帧，立即从相应的接口转发出去（除目标地址是自己）                                                           |
| 更新Update  | 交换机地址表中的表项默认的保存300秒<br>交换机重启会清空所有接口学习到的记录<br>接口关闭后会清空该接口学习到的记录<br>一个源MAC地址出现在别的接口上，会删除老的记录，添加新的记录 |
| 注：        | 对应一台交换机来说：<br>一个MAC地址只能关联一个接口上<br>一个接口可以存在多个MAC地址                                                     |

![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/captures/net/11111.png)
### 学习MAC地址
+ 交换机将收到的数据帧的源MAC地址和对应接口记录到MAC地址表中。


### 转发数据帧
+ 当数据帧的目的MAC地址不在MAC表中，或者目的MAC地址为嘎u功能波地址时，交换机会泛洪该帧。


### 目标主机回复
+ 交换机跟MAC地址表将目标主机的回复信息单播转发给源主机。


## 以太网接口工作模式
| **术语**         | **描述**                 |
|----------------|------------------------|
| 半双工half-duplex | 通信双方不能同时发送接收数据         |
| 全双工full-duplex | 通信双方可以同时发送接收数据         |
| 速率Speed        | 接口两端连接时进行协商，协商失败无法正常通信 |


可以设置两端的通信模式默认是自动（选取两端设备的最低值）

<front style="color: red;">网络速度无其他因素影响，但网速很慢可能是半双工模式</front>


## 交换机设置通信模式：
| **术语**                | **备注**     |
|-----------------------|------------|
| undo negotiation auto | 取消自动协商     |
| speed 100             | 设置速率       |
| duplex full           | 设置通信模式为全双工 |
| duplex half           | 设置通信模式为半双工 |

